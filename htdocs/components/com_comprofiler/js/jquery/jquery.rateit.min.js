(function(I){I.rateit={aria:{resetLabel:"reset rating",ratingLabel:"rating"}};I.fn.rateit=function(N,y){var C=1;var k={};var E="init";var M=function(e){return e.charAt(0).toUpperCase()+e.substr(1)};if(this.length===0){return this}var e=I.type(N);if(e=="object"||N===undefined||N===null){k=I.extend({},I.fn.rateit.defaults,N)}else if(e=="string"&&N!=="reset"&&y===undefined){return this.data("rateit"+M(N))}else if(e=="string"){E="setvalue"}return this.each(function(){var r=I(this);var n=function(e,t){if(t!=null){var a="aria-value"+(e=="value"?"now":e);var i=r.find(".rateit-range");if(i.attr(a)!=undefined){i.attr(a,t)}}arguments[0]="rateit"+M(e);return r.data.apply(r,arguments)};if(N=="reset"){var e=n("init");for(var t in e){r.data(t,e[t])}if(n("backingfld")){var a=I(n("backingfld"));if(a[0].nodeName=="SELECT"&&a[0].getAttribute("data-rateit-valuesrc")==="index"){a.prop("selectedIndex",n("value"))}else{a.val(n("value"))}a.trigger("change");if(a[0].min){a[0].min=n("min")}if(a[0].max){a[0].max=n("max")}if(a[0].step){a[0].step=n("step")}}r.trigger("reset")}if(!r.hasClass("rateit")){r.addClass("rateit")}var s=r.css("direction")!="rtl";if(E=="setvalue"){if(!n("init")){throw"Can't set value before init"}if(N=="readonly"&&y==true&&!n("readonly")){r.find(".rateit-range").unbind();n("wired",false)}if(N=="value"){y=y==null?n("min"):Math.max(n("min"),Math.min(n("max"),y))}if(n("backingfld")){var a=I(n("backingfld"));if(a[0].nodeName=="SELECT"&&a[0].getAttribute("data-rateit-valuesrc")==="index"){if(N=="value"){a.prop("selectedIndex",y)}}else{if(N=="value"){a.val(y)}}if(N=="min"&&a[0].min){a[0].min=y}if(N=="max"&&a[0].max){a[0].max=y}if(N=="step"&&a[0].step){a[0].step=y}}n(N,y)}if(!n("init")){n("mode",n("mode")||k.mode);n("icon",n("icon")||k.icon);n("min",isNaN(n("min"))?k.min:n("min"));n("max",isNaN(n("max"))?k.max:n("max"));n("step",n("step")||k.step);n("readonly",n("readonly")!==undefined?n("readonly"):k.readonly);n("resetable",n("resetable")!==undefined?n("resetable"):k.resetable);n("backingfld",n("backingfld")||k.backingfld);n("starwidth",n("starwidth")||k.starwidth);n("starheight",n("starheight")||k.starheight);n("value",Math.max(n("min"),Math.min(n("max"),!isNaN(n("value"))?n("value"):!isNaN(k.value)?k.value:k.min)));n("ispreset",n("ispreset")!==undefined?n("ispreset"):k.ispreset);if(n("backingfld")){var a=I(n("backingfld")).hide();if(a.attr("disabled")||a.attr("readonly")){n("readonly",true)}if(a[0].nodeName=="INPUT"){if(a[0].type=="range"||a[0].type=="text"){n("min",parseInt(a.attr("min"))||n("min"));n("max",parseInt(a.attr("max"))||n("max"));n("step",parseInt(a.attr("step"))||n("step"))}}if(a[0].nodeName=="SELECT"&&a[0].options.length>1){if(a[0].getAttribute("data-rateit-valuesrc")==="index"){n("min",!isNaN(n("min"))?n("min"):Number(a[0].options[0].index));n("max",Number(a[0].options[a[0].length-1].index));n("step",Number(a[0].options[1].index)-Number(a[0].options[0].index))}else{n("min",!isNaN(n("min"))?n("min"):Number(a[0].options[0].value));n("max",Number(a[0].options[a[0].length-1].value));n("step",Number(a[0].options[1].value)-Number(a[0].options[0].value))}var i=a.find("option[selected]");if(i.length==1){if(a[0].getAttribute("data-rateit-valuesrc")==="index"){n("value",i[0].index)}else{n("value",i.val())}}}else{n("value",a.val())}}var l=r[0].nodeName=="DIV"?"div":"span";C++;var d='<button id="rateit-reset-{{index}}" type="button" data-role="none" class="rateit-reset" aria-label="'+I.rateit.aria.resetLabel+'" aria-controls="rateit-range-{{index}}"><span></span></button><{{element}} id="rateit-range-{{index}}" class="rateit-range"'+(n("readonly")==true?"":' tabindex="0"')+' role="slider" aria-label="'+I.rateit.aria.ratingLabel+'" aria-owns="rateit-reset-{{index}}" aria-valuemin="'+n("min")+'" aria-valuemax="'+n("max")+'" aria-valuenow="'+n("value")+'"><{{element}} class="rateit-empty"></{{element}}><{{element}} class="rateit-selected"></{{element}}><{{element}} class="rateit-hover"></{{element}}></{{element}}>';r.append(d.replace(/{{index}}/gi,C).replace(/{{element}}/gi,l));if(!s){r.find(".rateit-reset").css("float","right");r.find(".rateit-selected").addClass("rateit-selected-rtl");r.find(".rateit-hover").addClass("rateit-hover-rtl")}if(n("mode")=="font"){r.addClass("rateit-font").removeClass("rateit-bg")}else{r.addClass("rateit-bg").removeClass("rateit-font")}n("init",JSON.parse(JSON.stringify(r.data())))}var f=n("mode")=="font";if(!f){r.find(".rateit-selected, .rateit-hover").height(n("starheight"))}var o=r.find(".rateit-range");if(f){var u=n("icon");var v=n("max")-n("min");var m="";for(var h=0;h<v;h++){m+=u}o.find("> *").text(m);n("starwidth",o.width()/(n("max")-n("min")))}else{o.width(n("starwidth")*(n("max")-n("min"))).height(n("starheight"))}var c="rateit-preset"+(s?"":"-rtl");if(n("ispreset")){r.find(".rateit-selected").addClass(c)}else{r.find(".rateit-selected").removeClass(c)}if(n("value")!=null){var g=(n("value")-n("min"))*n("starwidth");r.find(".rateit-selected").width(g)}var p=r.find(".rateit-reset");if(p.data("wired")!==true){p.bind("click",function(e){e.preventDefault();p.blur();var t=I.Event("beforereset");r.trigger(t);if(t.isDefaultPrevented()){return false}r.rateit("value",null);r.trigger("reset")}).data("wired",true)}var b=function(e,t){var a=t.changedTouches?t.changedTouches[0].pageX:t.pageX;var i=a-I(e).offset().left;if(!s){i=o.width()-i}if(i>o.width()){i=o.width()}if(i<0){i=0}return g=Math.ceil(i/n("starwidth")*(1/n("step")))};var x=function(e){var t=e*n("starwidth")*n("step");var a=o.find(".rateit-hover");if(a.data("width")!=t){o.find(".rateit-selected").hide();a.width(t).show().data("width",t);var i=[e*n("step")+n("min")];r.trigger("hover",i).trigger("over",i)}};var w=function(e){var t=I.Event("beforerated");r.trigger(t,[e]);if(t.isDefaultPrevented()){return false}n("value",e);if(n("backingfld")){if(a[0].nodeName=="SELECT"&&a[0].getAttribute("data-rateit-valuesrc")==="index"){I(n("backingfld")).prop("selectedIndex",e).trigger("change")}else{I(n("backingfld")).val(e).trigger("change")}}if(n("ispreset")){o.find(".rateit-selected").removeClass(c);n("ispreset",false)}o.find(".rateit-hover").hide();o.find(".rateit-selected").width(e*n("starwidth")-n("min")*n("starwidth")).show();r.trigger("hover",[null]).trigger("over",[null]).trigger("rated",[e]);return true};if(!n("readonly")){if(!n("resetable")){p.hide()}if(!n("wired")){o.bind("touchmove touchend",L);o.mousemove(function(e){var t=b(this,e);x(t)});o.mouseleave(function(e){o.find(".rateit-hover").hide().width(0).data("width","");r.trigger("hover",[null]).trigger("over",[null]);o.find(".rateit-selected").show()});o.mouseup(function(e){var t=b(this,e);var a=t*n("step")+n("min");w(a);o.blur()});o.keyup(function(e){if(e.which==38||e.which==(s?39:37)){w(Math.min(n("value")+n("step"),n("max")))}if(e.which==40||e.which==(s?37:39)){w(Math.max(n("value")-n("step"),n("min")))}});n("wired",true)}if(n("resetable")){p.show()}}else{p.hide()}o.attr("aria-readonly",n("readonly"))})};function L(e){var t=e.originalEvent.changedTouches,a=t[0],i="";switch(e.type){case"touchmove":i="mousemove";break;case"touchend":i="mouseup";break;default:return}var r=document.createEvent("MouseEvent");r.initMouseEvent(i,true,true,window,1,a.screenX,a.screenY,a.clientX,a.clientY,false,false,false,false,0,null);a.target.dispatchEvent(r);e.preventDefault()}I.fn.rateit.defaults={min:0,max:5,step:.5,mode:"bg",icon:"â˜…",starwidth:16,starheight:16,readonly:false,resetable:true,ispreset:false};I(function(){I("div.rateit, span.rateit").rateit()})})(jQuery);