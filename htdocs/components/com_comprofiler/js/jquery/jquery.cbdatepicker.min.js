(function(o){var m=[];var d={init:function(l){return this.each(function(){var t=this;var r=o(t).data("cbdatepicker");if(r){return}r={};r.options=typeof l!="undefined"?l:{};r.defaults=o.fn.cbdatepicker.defaults;r.settings=o.extend(true,{},r.defaults,r.options);r.strings=o.extend(true,{},o.datepicker.regional[""],r.settings.strings);r.element=o(t);r.selector=o(t);if(r.element.is('input[type="hidden"]')){r.selector=r.element.siblings(".cbDatePickerSelector")}if(r.settings.useData){o.each(r.defaults,function(e,t){if(e!="init"&&e!="useData"){var s=r.element.data("cbdatepicker"+e.charAt(0).toUpperCase()+e.slice(1));if(typeof s!="undefined"){r.settings[e]=s}else{s=r.element.data("cbdatepicker"+e.charAt(0).toUpperCase()+e.slice(1).toLowerCase());if(typeof s!="undefined"){r.settings[e]=s}}}})}r.element.triggerHandler("cbdatepicker.init.before",[r]);if(!r.settings.init){return}var s=(new Date).getFullYear();if(r.settings.minYear){if(typeof r.settings.minYear=="string"){var e=r.settings.minYear.substr(0,1);var i=r.settings.minYear.substr(1);if(e=="+"){r.settings.minYear=s+parseInt(i)}else if(e=="-"){r.settings.minYear=s-parseInt(i)}}}else{r.settings.minYear=s-99}if(r.settings.maxYear){if(typeof r.settings.maxYear=="string"){var a=r.settings.maxYear.substr(0,1);var n=r.settings.maxYear.substr(1);if(a=="+"){r.settings.maxYear=s+parseInt(n)}else if(a=="-"){r.settings.maxYear=s-parseInt(n)}}}else{r.settings.maxYear=s+99}if(r.settings.calendarType==2||r.settings.calendarType==3){var c=null;if(typeof moment!="undefined"){c=moment.locale();moment.locale(Math.random(),{months:r.strings.monthNames,monthsShort:r.strings.monthNamesShort,weekdays:r.strings.dayNames,weekdaysShort:r.strings.dayNamesShort,weekdaysMin:r.strings.dayNamesMin})}r.combodate=r.selector.combodate({format:r.settings.format,template:r.settings.template,minYear:r.settings.minYear,maxYear:r.settings.maxYear,firstItem:r.settings.firstItem,smartDays:true,yearDescending:r.settings.yearDescending,minuteStep:1,secondStep:1,customClass:r.settings.customClass});if(c){moment.locale(c)}r.selector.siblings(".combodate").children().on("change",function(e){var t=o(this).val();if(t!==""){o(this).siblings().each(function(){if(!o(this).val()){var e=null;if(o(this).hasClass("year")){e=o(this).children('option[value="'+s+'"]').val()}if(!e){e=o(this).children('option[value!=""]:first').val()}if(e){o(this).val(e)}}})}else{o(this).siblings().each(function(){o(this).val("")})}r.element.triggerHandler("cbdatepicker.select",[r,r.selector.combodate("getValue")])})}if(r.settings.calendarType==1||r.settings.calendarType==4||r.settings.addPopup){if(r.settings.showTime){r.datetimepicker=r.selector.datetimepicker({showAnim:"",showHour:r.settings.timeTemplate.toLowerCase().indexOf("h")!==-1,showMinute:r.settings.timeTemplate.toLowerCase().indexOf("m")!==-1,showSecond:r.settings.timeTemplate.toLowerCase().indexOf("s")!==-1,showMillisec:r.settings.timeTemplate.toLowerCase().indexOf("l")!==-1,showMicrosec:r.settings.timeTemplate.toLowerCase().indexOf("c")!==-1,stepMinute:1,stepSecond:1,altFieldTimeOnly:false,altTimeFormat:r.settings.calendarType==1||r.settings.calendarType==4?r.settings.timeFormat:null,timeFormat:r.settings.calendarType==1||r.settings.calendarType==4?r.settings.timeTemplate:r.settings.timeFormat,pickerTimeFormat:r.settings.timeTemplate,amNames:r.strings.amNames,pmNames:r.strings.pmNames,timeOnly:r.settings.timeOnly,timeOnlyTitle:r.strings.timeOnlyTitle,timeText:r.strings.timeText,hourText:r.strings.hourText,minuteText:r.strings.minuteText,secondText:r.strings.secondText,millisecText:r.strings.millisecText,microsecText:r.strings.microsecText,timezoneText:r.strings.timezoneText,onSelect:function(e){if(r.settings.addPopup){r.selector.combodate("setValue",e)}else{r.selector.change()}if(r.settings.calendarType==4){r.selector.siblings(".cbDatePickerSelected").html(e)}r.element.triggerHandler("cbdatepicker.select",[r,e])},yearRange:r.settings.minYear+":"+r.settings.maxYear,isRTL:r.settings.isRTL,firstDay:r.settings.firstDay,changeMonth:true,changeYear:true,showButtonPanel:false,altField:r.settings.calendarType==1||r.settings.calendarType==4?g(r,r.settings.target):null,altFormat:r.settings.calendarType==1||r.settings.calendarType==4?r.settings.dateFormat:null,dateFormat:r.settings.calendarType==1||r.settings.calendarType==4?r.settings.dateTemplate:r.settings.dateFormat,dayNames:r.strings.dayNames,dayNamesMin:r.strings.dayNamesMin,dayNamesShort:r.strings.dayNamesShort,monthNames:r.strings.monthNames,monthNamesShort:r.strings.monthNamesShort,prevText:r.strings.prevText,nextText:r.strings.nextText,currentText:r.strings.currentText,closeText:r.strings.closeText})}else{r.datepicker=r.selector.datepicker({onSelect:function(e){if(r.settings.addPopup){r.selector.combodate("setValue",e)}else{r.selector.change()}if(r.settings.calendarType==4){r.selector.siblings(".cbDatePickerSelected").html(e)}r.element.triggerHandler("cbdatepicker.select",[r,e])},showAnim:"",yearRange:r.settings.minYear+":"+r.settings.maxYear,isRTL:r.settings.isRTL,firstDay:r.settings.firstDay,changeMonth:true,changeYear:true,showButtonPanel:false,altField:r.settings.calendarType==1||r.settings.calendarType==4?g(r,r.settings.target):null,altFormat:r.settings.calendarType==1||r.settings.calendarType==4?r.settings.dateFormat:null,dateFormat:r.settings.calendarType==1||r.settings.calendarType==4?r.settings.dateTemplate:r.settings.dateFormat,dayNames:r.strings.dayNames,dayNamesMin:r.strings.dayNamesMin,dayNamesShort:r.strings.dayNamesShort,monthNames:r.strings.monthNames,monthNamesShort:r.strings.monthNamesShort,prevText:r.strings.prevText,nextText:r.strings.nextText,currentText:r.strings.currentText,closeText:r.strings.closeText})}}r.calendarHandler=function(e){e.preventDefault();e.stopPropagation();var t=r.selector.datepicker("widget");if(t.not(":visible").length){r.selector.datepicker("show");t.position({my:"left top+20",at:"left top",of:o(this)});if(t.css("z-index")<100){t.css("z-index",100)}}r.element.triggerHandler("cbdatepicker.calendar",[r])};r.selector.siblings(".cbDatePickerCalendar").on("click",r.calendarHandler);r.changeHandler=function(e){g(r,r.settings.target).val(d.get.call(t)).trigger("change")};r.selector.on("change",r.changeHandler);r.element.on("remove.cbdatepicker destroy.cbdatepicker",function(){r.element.cbdatepicker("destroy")});r.element.on("rebind.cbdatepicker",function(){r.element.cbdatepicker("rebind")});r.element.on("modified.cbdatepicker",function(e,t,s,i){if(t!=s){var a=r.element.attr("data-cbdatepicker-target");if(typeof a!="undefined"){r.element.attr("data-cbdatepicker-target",a.replace(t,s))}var n=r.element.data("cbdatepicker-target");if(typeof n!="undefined"){r.element.data("cbdatepicker-target",n.replace(t,s))}r.element.cbdatepicker("rebind")}});r.element.on("cloned.cbdatepicker",function(){var e=o(this);if(o(this).is('input[type="hidden"]')){e=o(this).siblings(".cbDatePickerSelector")}o(this).off(".cbdatepicker");o(this).removeData("cbdatepicker");e.removeData("combodate");e.removeData("datepicker");e.siblings(".combodate").remove();e.removeClass("hasDatepicker");e.siblings(".cbDatePickerCalendar").off("click",r.calendarHandler);e.off("change",r.changeHandler);o(this).cbdatepicker(r.options)});r.element.triggerHandler("cbdatepicker.init.after",[r]);r.element.data("cbdatepicker",r);m.push(r)})},get:function(){var e=o(this).data("cbdatepicker");if(!e){return""}var t="";if(e.settings.calendarType==2||e.settings.calendarType==3){if(e.settings.showTime){t=e.selector.combodate("getValue","YYYY-MM-DD HH:mm:ss")}else{t=e.selector.combodate("getValue","YYYY-MM-DD")}}else if(e.settings.calendarType==1||e.settings.calendarType==4){if(e.settings.showTime){t=e.selector.datetimepicker("getDate");if(t){t=new Date(t).toSQLDateTimeString()}}else{t=e.selector.datepicker("getDate");if(t){t=new Date(t).toSQLDateString()}}}if(t&&typeof moment!="undefined"){var s=false;if(e.settings.showTime&&e.settings.offset){t=t+e.settings.offset;s=true}var i=moment(t);if(!s&&e.settings.showTime&&e.settings.timezone&&e.settings.timezone!="UTC"&&typeof moment.tz!="undefined"){i=moment.tz(t,e.settings.timezone);s=true}if(i.isValid()){if(s){i.utc()}t=i.format(e.settings.format)}else{t=""}}else{t=""}return t},set:function(e){var t=o(this).data("cbdatepicker");if(!t){return this}if(t.settings.calendarType==2||t.settings.calendarType==3){t.selector.combodate("setValue",e)}else if(t.settings.calendarType==1||t.settings.calendarType==4){if(t.settings.showTime){t.selector.datetimepicker("setDate",e)}else{t.selector.datepicker("setDate",e)}}return this},rebind:function(){var e=o(this).data("cbdatepicker");if(!e){return this}e.element.cbdatepicker("destroy");e.element.cbdatepicker(e.options);return this},destroy:function(){var s=o(this).data("cbdatepicker");if(!s){return this}if(s.combodate){s.selector.combodate("destroy")}if(s.datetimepicker){s.selector.datetimepicker("destroy")}if(s.datepicker){s.selector.datepicker("destroy")}s.selector.siblings(".cbDatePickerCalendar").off("click",s.calendarHandler);s.selector.off("change",s.changeHandler);s.element.off(".cbdatepicker");o.each(m,function(e,t){if(t.element==s.element){m.splice(e,1);return false}return true});s.element.removeData("cbdatepicker");s.element.triggerHandler("cbdatepicker.destroyed",[s]);return this},instances:function(){return m}};function g(e,t){if(!t){return e.element}if(t.lastIndexOf("~ ",0)===0||t.lastIndexOf("+ ",0)===0||t.lastIndexOf("> ",0)===0||t.lastIndexOf(" ",0)===0){return e.element.find(t.trim())}return o(t)}function e(e){if(e<10){return"0"+e}return e}if(!Date.prototype.toSQLDateString){Date.prototype.toSQLDateString=function(){return this.getFullYear()+"-"+e(this.getMonth()+1)+"-"+e(this.getDate())}}if(!Date.prototype.toSQLDateTimeString){Date.prototype.toSQLDateTimeString=function(){return this.getFullYear()+"-"+e(this.getMonth()+1)+"-"+e(this.getDate())+" "+e(this.getHours())+":"+e(this.getMinutes())+":"+e(this.getSeconds())}}o.fn.cbdatepicker=function(e){if(d[e]){return d[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof e==="object"||!e){return d.init.apply(this,arguments)}return this};o.fn.cbdatepicker.defaults={init:true,useData:true,calendarType:2,template:"MM / DD / YYYY HH : mm : ss",format:"YYYY-MM-DD HH:mm:ss",timeTemplate:"HH:mm:ss",dateTemplate:"yy-mm-dd",timeFormat:"HH:mm:ss",dateFormat:"yy-mm-dd",minYear:"-99",maxYear:"+99",yearDescending:false,firstDay:0,timeOnly:false,showTime:false,addPopup:false,isRTL:false,customClass:null,firstItem:"empty",timezone:null,offset:null,target:null}})(jQuery);